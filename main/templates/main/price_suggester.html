{% extends 'main/admin_base.html' %}
{% load static i18n %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/price_suggester.css' %}">
{% endblock %}

{% block title %}{% trans "Price Suggester" %}{% endblock %}

{% block admin_content %}
    <h1 class="page-header-title">ðŸ’° {% trans "Price Suggester" %}</h1>
    <p class="page-subtitle">{% trans "Suggestions for room price adjustments based on popular events in Manchester" %}</p>

    <!-- Search Form -->
    <form method="get" class="search-form">
        <label for="keyword">{% trans "Event Location" %}:</label>
        <input type="text" name="keyword" value="{{ keyword }}" placeholder="{% trans 'e.g., Co-op Live, AO Arena' %}">
        <label for="start_date">{% trans "Start Date" %}:</label>
        <input type="date" name="start_date" value="{{ start_date }}">
        <label for="end_date">{% trans "End Date" %}:</label>
        <input type="date" name="end_date" value="{{ end_date }}">
        <button type="submit">{% trans "Search" %}</button>
    </form>

    <!-- Filter Form for Sold-Out Events -->
    <form method="get" class="filter-form">
        {% if show_sold_out %}
            <button type="submit" name="show_sold_out" value="">{% trans "Show All Popular Events" %}</button>
        {% else %}
            <button type="submit" name="show_sold_out" value="1">{% trans "Show Sold-Out Events" %}</button>
        {% endif %}
    </form>

    <!-- Suggestion List -->
    <div class="suggestion-list">
        {% if suggestions %}
            {% for suggestion in suggestions %}
                <div class="suggestion-item">
                    <h3>{{ suggestion.name }}</h3>
                    <p>{% trans "Date: " %}{{ suggestion.date }}</p>
                    <p>{% trans "Venue: " %}{{ suggestion.venue }}</p>
                    <p>{% trans "Ticket Price: " %}{{ suggestion.ticket_price }}</p>
                    <p>{% trans "Suggested Room Price: " %}<strong>{{ suggestion.suggested_price }}</strong></p>
                    {% if suggestion.image %}
                        <img src="{{ suggestion.image }}" alt="{% trans 'Event Image' %}">
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            {% if show_sold_out %}
                <p>{% trans "No sold-out events found for the given criteria." %}</p>
            {% else %}
                <p>{% trans "No popular events found to suggest price changes." %}</p>
            {% endif %}
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
                <a href="?start_date={{ start_date }}&end_date={{ end_date }}&keyword={{ keyword }}&show_sold_out={{ show_sold_out }}&page={{ current_page|add:'-1' }}">{% trans "Previous" %}</a>
            {% endif %}

            {% for page_num in page_range %}
                {% if page_num == current_page %}
                    <span class="current">{{ page_num }}</span>
                {% else %}
                    <a href="?start_date={{ start_date }}&end_date={{ end_date }}&keyword={{ keyword }}&show_sold_out={{ show_sold_out }}&page={{ page_num }}">{{ page_num }}</a>
                {% endif %}
            {% endfor %}

            {% if current_page < total_pages %}
                <a href="?start_date={{ start_date }}&end_date={{ end_date }}&keyword={{ keyword }}&show_sold_out={{ show_sold_out }}&page={{ current_page|add:'1' }}">{% trans "Next" %}</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
        </div>
    {% endif %}

{% endblock %}