{% load static %}

{% load i18n %}

<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Pick A Rooms{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

    <!-- Block for additional CSS -->
    {% block extra_css %}{% endblock %}
</head>
<body>

    <!-- Navigation -->
    <header>
        <div class="logo">
            <a href="/">
                <img src="https://res.cloudinary.com/dkqpb7vwr/image/upload/v1739377149/pickarooms-logo2_gjeqm3.png" 
                     alt="Pick-A-Rooms Logo" class="logo-img">
            </a>
        </div>        

        <div class="language-switcher">
            <form action="{% url 'set_language' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">  <!-- Preserve current page -->
                <select name="language" onchange="this.form.submit()">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% for lang_code, lang_name in LANGUAGES %}
                        <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}>{{ lang_name }}</option>
                    {% endfor %}
                </select>
            </form>            
        </div>
        
               

        <div class="menu-toggle" id="mobile-menu">
            <p class="menu"><i class="fa-solid fa-bars"></i></p>
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="/" class="{% if request.path == '/' %}active{% endif %}">{% trans "Home" %}</a></li>
                <li><a href="/about/" class="{% if request.path == '/about/' %}active{% endif %}">{% trans "About" %}</a></li>
                <li><a href="/checkin/" class="{% if request.path == '/checkin/' %}active{% endif %}">{% trans "Check-In" %}</a></li>
                <li><a href="/explore-manchester/" class="{% if request.path == '/explore-manchester/' %}active{% endif %}">{% trans "Explore Manchester" %}</a></li>
                <li><a href="{% url 'awards_reviews' %}" class="{% if request.path == '/awards_reviews/' %}active{% endif %}">{% trans "Awards & Reviews" %}</a></li>
                <li><a href="/contact/" class="{% if request.path == '/contact/' %}active{% endif %}">{% trans "Contact Us" %}</a></li>
        
                {% if user.is_authenticated %}
                    <li><a href="/admin-page/" class="{% if request.path == '/admin-page/' %}active{% endif %}">{% trans "Admin Only" %}</a></li>
                    <li>
                        <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="logout-btn">{% trans "Logout" %}</button>
                        </form>
                    </li>
                {% else %}
                    <li><a href="/admin-page/login/" class="{% if request.path == '/admin-page/login/' %}active{% endif %}">{% trans "Admin Login" %}</a></li>
                {% endif %}
            </ul>
        </nav>             
    </header>

    <!-- Confirmation Message -->
    {% if messages %}
        <ul id="confirmation-message">
            {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- Main content -->
    <div class="content-wrapper">
        <main>
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <p>&copy; 2025 Pick-A-Rooms. {% trans "All rights reserved." %}</p>
            <ul class="footer-links">
                <li><a href="{% url 'about' %}">{% trans "About Us" %}</a></li>
                <li><a href="{% url 'contact' %}">{% trans "Contact Us" %}</a></li>
                <li><a href="{% url 'how_to_use' %}">{% trans "How to use guide" %}</a></li>
                <li><a href="{% url 'awards_reviews' %}">{% trans "Awards & Reviews" %}</a></li>
                <li><a href="{% url 'privacy_policy' %}">{% trans "Privacy Policy" %}</a></li>
                <li><a href="{% url 'terms_of_use' %}">{% trans "Terms of Use" %}</a></li>
                <li><a href="{% url 'terms_conditions' %}">{% trans "Terms & Conditions" %}</a></li>
                <li><a href="{% url 'cookie_policy' %}">{% trans "Cookie Policy" %}</a></li>
                <li><a href="{% url 'sitemap' %}">{% trans "Sitemap" %}</a></li>
                <li><a href="https://booking.com" target="blank">{% trans "Booking.com" %}</a></li>
            </ul>
            <p>{% trans "WebApp by Henry" %} <span class="email"><a href="mailto:easybulb@gmail.com">easybulb@gmail.com</a></span></p>
        </div>
    </footer>    

    <!-- Cookie Consent Banner (Hidden by Default) -->
    <div id="cookie-banner" class="cookie-banner" style="display: none;">
        <p>We use cookies to enhance your experience on Pick-A-Rooms. By clicking "Accept," you agree to our use of cookies. <a href="{% url 'cookie_policy' %}">Learn more</a>.</p>
        <div class="cookie-btn-container">
            <button id="accept-cookies" class="cookie-btn">Accept</button>
            <button id="decline-cookies" class="cookie-btn decline">Decline</button>
        </div>
    </div>

    <!-- Font Awesome Script -->
    <script src="https://kit.fontawesome.com/f40ce1e09e.js" crossorigin="anonymous"></script>

    <script src="{% static 'js/script.js' %}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Hide confirmation message after 3 seconds
            const confirmationMessage = document.getElementById("confirmation-message");
            if (confirmationMessage) {
                setTimeout(() => {
                    confirmationMessage.style.display = "none";
                }, 3000);
            }
    
            // Function to show cookie banner
            function showCookieBanner() {
                const cookieBanner = document.getElementById("cookie-banner");
    
                // Show banner only if no previous choice is saved
                if (!localStorage.getItem("cookieConsent")) {
                    cookieBanner.style.display = "flex";
    
                    document.getElementById("accept-cookies").addEventListener("click", function () {
                        localStorage.setItem("cookieConsent", "accepted");
                        cookieBanner.style.display = "none";
                    });
    
                    document.getElementById("decline-cookies").addEventListener("click", function () {
                        localStorage.setItem("cookieConsent", "declined");
                        cookieBanner.style.display = "none";
                    });
                }
            }
    
            // Fetch visitor location and show cookie banner for UK/EU
            fetch("https://ipapi.co/json/")
                .then(response => response.json())
                .then(data => {
                    const euCountries = ["GB", "FR", "DE", "ES", "IT", "NL", "BE", "SE", "DK", "FI", "IE", "PT", "AT", "PL", "GR"];
                    if (euCountries.includes(data.country_code)) {
                        showCookieBanner();
                    }
                })
                .catch(error => console.error("Error fetching location:", error));
        });
    </script>
    
</body>
</html>
